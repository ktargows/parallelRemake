<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>parallelRemake &bull; parallelRemake</title><!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous"><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">parallelRemake</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/index.html">Articles</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>parallelRemake</h1>
                        <h4 class="author">William Michael Landau</h4>
            
            <h4 class="date">2017-02-07</h4>
          </div>

    
    
<div class="contents">
<p>The <code>parallelRemake</code> package is a helper add-on for <a href="https://github.com/richfitz/remake"><code>remake</code></a>, a <a href="https://www.gnu.org/software/make/">Makefile</a>-like reproducible build system for R. If you haven&rsquo;t done so already, go learn <a href="https://github.com/richfitz/remake"><code>remake</code></a>! Also learn <a href="https://www.gnu.org/software/make/">GNU make</a>, and then recall that <code>make -j 4</code> runs a <a href="https://www.gnu.org/software/make/">Makefile</a> while distributing the rules over four parallel processes. This mode of parallelism is the whole point of <code>parallelRemake</code>. With <code>parallelRemake</code>, you can write an overarching <a href="https://www.gnu.org/software/make/">Makefile</a> for a <a href="https://github.com/richfitz/remake"><code>remake</code></a> project to run <a href="https://github.com/richfitz/remake"><code>remake</code></a> targets in parallel. This distributed parallelism is extremely helpful for large clusters that use the <a href="http://slurm.schedmd.com/">Slurm job scheduler</a>, for example, as explained in <a href="http://plindenbaum.blogspot.com/2014/09/parallelizing-gnu-make-4-in-slurm.html">this post</a>.</p>
<div id="rtools-for-windows-users" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#rtools-for-windows-users" class="anchor"> </a></body></html>Rtools for Windows users</h1>
<p>The example and tests sometimes use <code>system("make")</code> and similar commands. So if you&rsquo;re using the Windows operating system, you will need to install the <a href="https://github.com/stan-dev/rstan/wiki/Install-Rtools-for-Windows"><code>Rtools</code></a> package.</p>
</div>
<div id="help-and-troubleshooting" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#help-and-troubleshooting" class="anchor"> </a></body></html>Help and troubleshooting</h1>
<p>Use the <code><a href="../reference/help_parallelRemake.html">help_parallelRemake()</a></code> function to obtain a collection of helpful links. For troubleshooting, please refer to <a href="https://github.com/wlandau/parallelRemake/blob/master/TROUBLESHOOTING.md">TROUBLESHOOTING.md</a> on the <a href="https://github.com/wlandau/parallelRemake">GitHub page</a> for instructions.</p>
</div>
<div id="examples" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#examples" class="anchor"> </a></body></html>Examples</h1>
<p>Run <code><a href="../reference/list_examples_parallelRemake.html">list_examples_parallelRemake()</a></code> to see the available examples, and run <code><a href="../reference/example_parallelRemake.html">example_parallelRemake()</a></code> to output an example to your current working directory. To run the basic example,</p>
<ol style="list-style-type: decimal"><li>Call <code><a href="../reference/example_parallelRemake.html">example_parallelRemake("basic")</a></code> in an R session.</li>
<li>Call <code>setwd("basic")</code> to enter the <code>"basic"</code> folder.</li>
<li>call <code><a href="../reference/write_makefile.html">write_makefile()</a></code> to generate the <code>Makefile</code>.</li>
<li>Use <a href="https://www.gnu.org/software/make/"><code>Makefile</code></a> to run the workflow. Do any of the following in any order.
<ul><li><code>system("make")</code> just runs the workflow in 1 process.</li>
<li><code>system("make -j 2")</code> distributes the workflow over two parallel processes.</li>
<li><code>system("make clean")</code> removes the files created by <a href="https://github.com/richfitz/remake"><code>remake</code></a>.</li>
</ul></li>
</ol></div>
<div id="more-on-write_makefile" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#more-on-write_makefile" class="anchor"> </a></body></html>More on <code><a href="../reference/write_makefile.html">write_makefile()</a></code></h1>
<p>The <code><a href="../reference/write_makefile.html">write_makefile()</a></code> function has additional arguments. You can control the names of the <a href="https://www.gnu.org/software/make/"><code>Makefile</code></a> and the <a href="https://github.com/richfitz/remake"><code>remake</code></a>/<a href="http://yaml.org/"><code>YAML</code></a> file with the <code>makefile</code> and <code>remakefile</code> arguments, respectively. You can add lines to the beginning of the <a href="https://www.gnu.org/software/make/"><code>Makefile</code></a> with the <code>begin</code> argument, which could be useful for setting up the workflow for execution on a cluster, for example. You can append commands to <code>make clean</code> with the <code>clean</code> argument. In addition, the <code>remake_args</code> argument passes additional arguments to <code>remake::make()</code>. For example, <code><a href="../reference/write_makefile.html">write_makefile(remake_args = list(verbose = FALSE))</a></code> is equivalent to <code>remake::make(..., verbose = F)</code> for each target. You cannot set <code>target_names</code> or <code>remake_file</code> this way.</p>
</div>
<div id="high-performance-computing" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#high-performance-computing" class="anchor"> </a></body></html>High-performance computing</h1>
<p>If you want to run <code>make -j</code> to distribute tasks over multiple nodes of a <a href="http://slurm.schedmd.com/">Slurm</a> cluster, you should generate a Makefile like the one in <a href="http://plindenbaum.blogspot.com/2014/09/parallelizing-gnu-make-4-in-slurm.html">this post</a>. To do this, run the following in an R session</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/write_makefile.html">write_makefile</a></span>(..., 
  <span class="dt">begin =</span> <span class="kw">c</span>(
    <span class="st">"SHELL=srun"</span>,
    <span class="st">".SHELLFLAGS= &lt;ARGS&gt; bash -c"</span>))</code></pre></div>
<p>where <code>&lt;ARGS&gt;</code> stands for additional arguments to <code>srun</code>. Then, once the <a href="https://www.gnu.org/software/make/">Makefile</a> is generated, you distribute the work over <code>[N]</code> simultaneous jobs by running the following in the <a href="http://linuxcommand.org/">Linux command line</a>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nohup nice -<span class="dv">19</span> make -j [N] &amp;</code></pre></div>
<p>For other task managers such as <a href="https://en.wikipedia.org/wiki/Portable_Batch_System">PBS</a>, you may have to create a custom stand-in for a shell. For example, suppose we are using the Univa Grid Engine. From R, call</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/write_makefile.html">write_makefile</a></span>(.., <span class="dt">begin =</span> <span class="st">"SHELL = ./shell.sh"</span>)</code></pre></div>
<p>where the file <code>shell.sh</code> contains</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#!/bin/bash</span>
shift
echo <span class="st">"module load R; $*"</span> |<span class="st"> </span>qsub -sync y -cwd -j y</code></pre></div>
<p>Now, in the Linux command line, enable execution with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">chmod +x shell.sh</code></pre></div>
<p>and then distribute the work over <code>[N]</code> simultaneous jobs with</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">nohup nice -<span class="dv">19</span> make -j [N] &amp;</code></pre></div>
<p>The same approach should work for <a href="https://en.wikipedia.org/wiki/Platform_LSF">LSF systems</a>, where <code>make</code> replaced by <a href="https://www.ibm.com/support/knowledgecenter/SSETD4_9.1.3/lsf_admin/lsmake_how_works_lsf.html"><code>lsmake</code></a> and the <a href="https://www.gnu.org/software/make/">Makefile</a> is compatible.</p>
<p>Regardless of the system, be sure that all nodes point to the same working directory so that they share the same <code>.remake</code> <a href="https://github.com/richfitz/storr">storr</a> cache. For the Univa Grid Engine, the <code>-cwd</code> flag for <code>qsub</code> accomplishes this.</p>
</div>
<div id="use-with-the-downsize-package" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#use-with-the-downsize-package" class="anchor"> </a></body></html>Use with the <a href="https://github.com/wlandau/downsize">downsize</a> package</h1>
<p>The <a href="https://github.com/wlandau/downsize">downsize</a> package is compatible with <a href="https://github.com/wlandau/parallelRemake">parallelRemake</a> and <a href="https://github.com/wlandau/remakeGenerator">remakeGenerator</a> workflows, and the <a href="https://github.com/wlandau/remakeGenerator/blob/master/vignettes/remakeGenerator.Rmd">remakeGenerator vignette</a> explains how to use these packages together.</p>
</div>
<div id="accessing-the-remake-cache-for-debugging-and-testing" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#accessing-the-remake-cache-for-debugging-and-testing" class="anchor"> </a></body></html>Accessing the <a href="https://github.com/richfitz/remake"><code>remake</code></a> cache for debugging and testing</h1>
<p>Intermediate <a href="https://github.com/richfitz/remake"><code>remake</code></a> objects are maintained in <a href="https://github.com/richfitz/remake"><code>remake</code></a>&rsquo;s hidden <a href="https://github.com/richfitz/storr"><code>storr</code></a> cache. At any point in the workflow, you can reload them using <code><a href="../reference/recall.html">recall(name)</a></code>, where <code>name</code> is a character string denoting the name of a cached object, and you can see the names of all the available objects with the <code><a href="../reference/recallable.html">recallable()</a></code> function. Enter multiple names to return a named list of multiple objects (i.e., <code><a href="../reference/recall.html">recall(name1, name2)</a></code>). <strong>Important: this is only recommended for debugging and testing. Changes to the cache are not tracked and thus not reproducible.</strong></p>
<p>The functions <code>create_bindings()</code> and <code>make_environment()</code> are alternatives from <a href="https://github.com/richfitz/remake"><code>remake</code></a> itself. Just be careful with <code>create_bindings()</code> if your project has a lot of data.</p>
</div>
<div id="multiple-remakeyaml-files" class="section level1">
<h1 class="hasAnchor"><html><body><a href="#multiple-remakeyaml-files" class="anchor"> </a></body></html>Multiple <a href="https://github.com/richfitz/remake"><code>remake</code></a>/<a href="http://yaml.org/"><code>YAML</code></a> files</h1>
<p><a href="https://github.com/richfitz/remake"><code>remake</code></a> has the option to split the workflow over multiple <a href="http://yaml.org/"><code>YAML</code></a> files and collate them with the &ldquo;include:&rdquo; field. If that&rsquo;s the case, just specify all the root nodes in the <code>remakefiles</code> argument to <code><a href="../reference/write_makefile.html">write_makefile()</a></code>. (You could also specify every single <a href="http://yaml.org/"><code>YAML</code></a> file, but that&rsquo;s tedious.) If needed, <code><a href="../reference/write_makefile.html">write_makefile()</a></code> will recursively combine the targets, sources, etc. in the constituent <code>remakefiles</code> and output a new collated <a href="http://yaml.org/"><code>YAML</code></a> file that the master <a href="https://www.gnu.org/software/make/"><code>Makefile</code></a> will then use.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2>Contents</h2>
      <ul class="nav nav-pills nav-stacked"><li><a href="#rtools-for-windows-users">Rtools for Windows users</a></li>
      <li><a href="#help-and-troubleshooting">Help and troubleshooting</a></li>
      <li><a href="#examples">Examples</a></li>
      <li><a href="#more-on-write_makefile">More on <code><a href="../reference/write_makefile.html">write_makefile()</a></code></a></li>
      <li><a href="#high-performance-computing">High-performance computing</a></li>
      <li><a href="#use-with-the-downsize-package">Use with the </a><a href="https://github.com/wlandau/downsize">downsize</a> package</li>
      <li><a href="#accessing-the-remake-cache-for-debugging-and-testing">Accessing the </a><a href="https://github.com/richfitz/remake"><code>remake</code></a> cache for debugging and testing</li>
      <li><a href="#multiple-remakeyaml-files">Multiple </a><a href="https://github.com/richfitz/remake"><code>remake</code></a>/<a href="http://yaml.org/"><code>YAML</code></a> files</li>
      </ul></div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by William Michael Landau.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer></div>

  </body></html>
